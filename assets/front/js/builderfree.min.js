!function(t){"use strict";window.matchMedia("(max-width: 576px)").matches;const e=window.matchMedia("(max-width: 768px)").matches,o=WCCON_BUILDER_FRONT.currency_format_symbol,s=WCCON_BUILDER_FRONT.price_position,i=WCCON_BUILDER_FRONT.decimals?WCCON_BUILDER_FRONT.decimals:2,n=WCCON_BUILDER_FRONT.decimal_separator?WCCON_BUILDER_FRONT.decimal_separator:".",c=WCCON_BUILDER_FRONT.thousand_separator;function a(t){let e=t.toFixed(i);switch(e=e.replace(".",n),c&&(e=function(t){const e=/(\d+)(\d{3})/;return String(t).replace(/^\d+/,(function(t){for(;e.test(t);)t=t.replace(e,"$1"+c+"$2");return t}))}(e)),s){case"left":e=`${o}${e}`;break;case"right":e=`${e}${o}`;break;case"left_space":e=`${o} ${e}`;break;case"right_space":e=`${e} ${o}`}return e}function r(t){return parseInt(t,10)<1||isNaN(parseInt(t,10))?0:parseInt(t,10)}function l(t){return t.map((t=>t.hasOwnProperty("components")?{...t,components:l(t.components)}:{...t,products:[]}))}function d(t,e,o,s,i=!1){return e.map((e=>{if(e.slug===t){if("add"===s){if(console.log("type:add"),e.multiple){const t=e.products.filter((t=>parseInt(t.clone,10)!==parseInt(o.clone,10)));return{...e,products:[...t,o]}}return{...e,products:[o]}}return{...e,products:e.products.filter((t=>e.multiple?parseInt(t.clone,10)!==parseInt(o.clone,10):t.product_id!==o.product_id)).map(((t,e)=>({...t,clone:e})))}}if(e.hasOwnProperty("components")){let i=!1;return e.hasOwnProperty("multiple")&&e.multiple&&(i=!0),{...e,components:d(t,e.components,o,s,i)}}return e})).filter((t=>null!==t))}function p(t,e,o,s,i){return s.map((s=>s.slug===t?{...s,products:s.products.map((t=>t.product_id===e||t.variation_id===e?{...t,quantity:i}:t))}:s.hasOwnProperty("components")?{...s,components:p(t,e,o,s.components,i)}:s))}function u(o){const s=window.innerHeight,i=t(o),n=i.find(".wccon-saved-lists"),c=i.find(".wccon-modal-inner"),a=i.find(".wccon-modal__header"),r=i.find(".wccon-button-container"),l=(c.outerHeight(),a.outerHeight());let d=r.outerHeight();d||(d=50);let p=150;e&&(p=50);const u=s-l-d-p;n.height(u)}function h(t,e,o=[]){let s=o;for(const i of e){if(i.slug===t){if(i.hasOwnProperty("components"))for(const t of i.components)s=[...s,...t.products];else s=[...o,...i.products];break}if(i.hasOwnProperty("components")){if(s.length)break;s=h(t,i.components,s)}}return console.log("Component products:",s),s}function m(t,e=[]){for(const o of t){if(o.hasOwnProperty("components"))for(const t of o.components)t.hasOwnProperty("products")&&t.products.length&&(e=[...e,...t.products]),t.hasOwnProperty("components")&&(e=m(t.components,e));o.hasOwnProperty("products")&&o.products.length&&(e=[...e,...o.products])}return e}function g(e,o,s=!0,i=!1){const n=[],c=t(document.body).find(`${e}`);if(!c.length)return;const a=t("<div />",{class:"wccon-saved-lists wccon-skeleton-saved-lists"});for(let e=0;e<o;e++){const e=t("<div/>",{class:"wccon-skeleton-item"}),o=t("<div/>",{class:"wccon-skeleton-head"}),s=t("<div/>",{class:"wccon-skeleton-body"}),i=t("<div/>",{class:"wccon-skeleton-body__left"}),c=t("<div/>",{class:"wccon-skeleton-body__right"}),a=t("<ul/>",{class:"wccon-skeleton-list"}),r=t("<div/>",{class:"wccon-skeleton-footer"}),l=t("<div/>",{class:"wccon-skeleton-footer__left"}),d=t("<div/>",{class:"wccon-skeleton-footer__right"});r.append(l),r.append(d);for(let e=0;e<6;e++){const e=t("<li/>",{class:"wccon-skeleton-list__item"});a.append(e)}c.append(a),s.append(i),s.append(c),e.append(o),e.append(s),e.append(r),n.push(e)}s&&(i?c.append(n):(a.append(n),c.append(a))),s||c.html(n.map((t=>t.length?t.get(0).outerHTML:null)).filter((t=>null!==t)).join(""))}function _(e,o="on"){const s=e.find('a[href]:not([disabled]), button:not([disabled]), textarea:not([disabled]), input[type="text"]:not([disabled]), input[type="radio"]:not([disabled]), input[type="checkbox"]:not([disabled]), select:not([disabled])'),i=s.first(),n=s.last(),c=function(o){if(!("Tab"===o.key||9===o.keyCode))return;t("html, body").animate({scrollTop:e.offset().top},0);const s=t(o.target);o.shiftKey?(s.is(e)||s.is(i))&&(o.preventDefault(),n.focus()):s.is(n)&&(o.preventDefault(),i.focus())};"on"===o?(e.attr("tabindex","-1").focus(),e.on("keydown.wccon",c)):e.off("keydown.wccon")}class f{constructor(e){this.searchTimeOut,this.productRequest=null,this.compatibilityRequest=null,this.builderWrapper=t(e),this.builderId=this.builderWrapper.attr("data-wccon-builder"),this.builderWrapperData=JSON.parse(this.builderWrapper.attr("data-wccon-scheme")),this.ajaxUrl=WCCON_BUILDER_FRONT.ajax_url,this.compatiblityEnabled=WCCON_BUILDER_FRONT.compatibility_enabled,this.successMessage=WCCON_BUILDER_FRONT.i18n_success_message,this.copiedMessage=WCCON_BUILDER_FRONT.i18n_copied_message,this.errorMessage=WCCON_BUILDER_FRONT.i18n_error_message,this.addedToCartMessage=WCCON_BUILDER_FRONT.i18n_added_to_cart,this.saveToStorage=WCCON_BUILDER_FRONT.local_storage,this.soldIndividually=WCCON_BUILDER_FRONT.sold_individually,this.nonce=WCCON_BUILDER_FRONT.nonce,this.currentLang=function(){if(WCCON_BUILDER_FRONT.languages&&Array.isArray(WCCON_BUILDER_FRONT.languages)){const t=WCCON_BUILDER_FRONT.languages.find((t=>1==t.active||t.active));return t?t.code:null}return null}();const o=new URLSearchParams(window.location.search);this.savedListQuery=o.get("wccon-list"),this.savedList=localStorage.getItem("wccon-list"),this.maybeClearLists.bind(this)(),console.log("Builder data vs storage Data before:",this.builderWrapperData,JSON.parse(this.savedList)),this.productScheme=this.rebuildList.bind(this)(),console.log("Builder data vs storage Data after:",this.builderWrapperData,JSON.parse(this.savedList)),console.log("Product scheme",this.productScheme),this.componentContainer=t(e).find(".wccon-component").first(),this.componentHead=this.builderWrapper.find(".wccon-component-inner"),this.addCartButton=this.builderWrapper.find(".wccon-add-to-cart"),this.multipleButtons=this.builderWrapper.find(".wccon-component-product__multiple"),this.openedContent=!0,this.totalsContainer=this.builderWrapper.find(".wccon-bottom-block"),this.saveListButton=this.builderWrapper.find(".wccon-save-list-button"),this.clearListButton=this.builderWrapper.find(".wccon-clear-list-button"),this.shareListButton=this.builderWrapper.find(".wccon-share-list-button"),this.shareListButtonClose=this.builderWrapper.find(".wccon-share-close"),this.openMyLists=this.builderWrapper.find(".wccon-open-user-lists"),this.openUsersLists=this.builderWrapper.find(".wccon-open-lists"),this.closeModalButton=t(document.body).find(".wccon-modal__close"),this.dataStore=this.productScheme.groups,this.incompatibleData=[],this.totalPrice=0,this.totalPriceField=this.builderWrapper.find(".wccon-total-price"),this.timeOutAnimationLoading=wp.hooks.applyFilters("wccon-timeout-loading",800),this.loadListTimeOut=null,this.isMobile=window.matchMedia("(max-width: 576px)").matches,this.isTablet=window.matchMedia("(max-width: 768px)").matches,this.isDesktop=window.matchMedia("(min-width: 998px)").matches,this.toolTips=this.builderWrapper.find(".wccon-tooltip"),this.tippyInstances=[],this.initTooltips(),this.toggleExtraContainer=this.builderWrapper.find(".wccon-component-extra"),this.isListExists()&&this.runCompatibilitySaved(),this.builderWrapper.on("wccon-products-loaded",((t,e)=>{this.initProperties("init"),this.initEvents(),this.initPriceWidget("init")})).on("wccon-filter-end",((t,e)=>{this.initProperties("ajax"),this.initEvents(),this.initPriceWidget("ajax")}));const s=this;this.builderWrapper.on("click",".wccon-refresh-button",this.editProduct.bind(this)).on("click",".wccon-close-button",this.removeProduct.bind(this)).on("click",".wccon-collapse-button",this.collapseProducts.bind(this)).on("click",".wccon-component-product__multiple",this.addMultiple.bind(this)).on("click",".wccon-dropdown-select",this.handleSelect.bind(this)).on("click",".wccon-dropdown-select li a",this.handleSorting.bind(this)).on("click",".product-attribute-group__nice-select",this.handleVariationSelectOpen.bind(this)).on("click",".product-attribute-group__nice-select li",this.handleVariationSelect.bind(this)).on("click",".product-attribute-group__color li, .product-attribute-group__button li",this.handleVariationColor.bind(this)).on("click",".wccon-pagination-item",this.handlePagination.bind(this)).on("click",".wccon-product-title .desc-toggler",this.handleExpandDescription.bind(this)).on("click",".product-item__add",this.chooseProduct.bind(this)).on("wccon-load-list-start",this.loadListStart.bind(this)).on("wccon-load-list-end",this.loadListEnd.bind(this)).on("click",".wccon-reset_variations",this.resetVariations.bind(this)).on("click",".wccon-widget-head",this.toggleWidget).on("click",".widget-expander-show",this.expandWidget).on("click",".widget-expander-hide",this.collapseWidget).on("click",".wccon-clear-all",this.clearFilters.bind(this)).on("click",".wccon-filters-btn",this.openFilters).on("click",".wccon-close-filters",this.closeFilters).on("click",".wccon-component-inner",this.maybeGetProducts.bind(this)).on("click",".share-link",this.copyLink.bind(this)).on("click",".plus, .minus",(function(e){e.preventDefault(),e.stopPropagation();let o=1;const i=t(this).siblings("input"),n=parseFloat(i.val()),c=parseFloat(i.attr("max")),r=parseFloat(i.attr("min")),l=i.attr("step");n&&""!==n&&"NaN"!==n||(n=0),""!==c&&"NaN"!==c||(c=""),""!==r&&"NaN"!==r||(r=0),"any"!==l&&""!==l&&void 0!==l&&"NaN"!==parseFloat(l)||(l=1),t(this).is(".plus")?c&&n>=c?(i.val(c),o=c):(i.val(n+parseFloat(l)),o=n+parseFloat(l)):r&&n<=r?(i.val(r),o=r):n>0&&(i.val(n-parseFloat(l)),o=n-parseFloat(l)),i.trigger("change");const d=t(this).closest(".wccon-component-product-item").find(".wccon-component-product").attr("data-product-id"),u=t(this).closest(".wccon-component-product-item").find(".wccon-component-product").attr("data-variation-id"),h=t(this).closest(".wccon-component").attr("data-component-slug");s.dataStore=p(h,d,u,s.productScheme.groups,o),s.productScheme={...s.productScheme,groups:s.dataStore},s.maybeSaveToStorage(),s.totalPrice=s.calculateTotals(),s.totalPriceField.html(a(s.totalPrice))})),this.addCartButton.on("click",this.buyProduct.bind(this)),this.saveListButton.on("click",this.saveList.bind(this)),this.clearListButton.on("click",this.clearList.bind(this)),this.shareListButton.on("click",this.shareList),this.shareListButtonClose.on("click",this.shareList),this.openUsersLists.on("click",this.openUsersListsHandler),this.openMyLists.on("click",this.openMyListsHandler),this.closeModalButton.on("click",this.closeModal),this.toggleExtraContainer.on("click",this.toggleExtraHandler.bind(this)),this.isListExists()||this.maybeLoadList.bind(this)(),t(document.body).on("wccon_builder_loaded",(function(e,o){o.isTablet&&t("#wccon-share-modal .wccon-modal__body").append(t(".wccon-share-box").addClass("active"));m(o.dataStore).length||o.addCartButton.attr("disabled",!0),o.isAccountPage()&&o.builderWrapper.width()<900&&o.isDesktop&&o.builderWrapper.addClass("minimal")})),this.builderWrapper.on("wccon-product-chosen",((t,e,o,s)=>{const i=m(s);console.log("choosen",s,i),i.length?this.addCartButton.attr("disabled",!1):this.addCartButton.attr("disabled",!0)})),this.builderWrapper.on("wccon-product-removed",((t,e,o,s)=>{const i=m(s);console.log("removed",i),i.length?this.addCartButton.attr("disabled",!1):this.addCartButton.attr("disabled",!0)})),this.builderWrapper.on("wccon-builder-cleared",((t,e)=>{this.addCartButton.attr("disabled",!0)})),t(document.body).trigger("wccon_builder_loaded",this)}initProperties(t){this.componentHead=this.builderWrapper.find(".wccon-component-inner"),this.multipleButtons=this.builderWrapper.find(".wccon-component-product__multiple"),this.form=this.builderWrapper.find("#wccon-filter-form"),this.searchField=this.builderWrapper.find("#wccon-product-search"),this.paginationLinks=this.builderWrapper.find(".wccon-pagination-item"),this.query=new URLSearchParams,"init"===t&&(this.activeFilters={tax_query:[],meta_query:[],search:"",prices:[],pagination:1,stock:"all",orderby:"menu_order"},this.maxPrice=0,this.minPrice=0,this.manualChangedPrice=!1)}initEvents(){this.form.on("change",this.handleForm.bind(this)),this.searchField.on("keyup",this.search.bind(this));const e=this;t("select[name^=attribute_]",this.builderWrapper).on("change",(function(o){const s=t(this).closest(".wccon-product-item");e.chooseVariation(s)}));const o=this.builderWrapper.find(`.wccon-component.opened[data-component-slug=${this.componentSlug}]`);o.find(".wccon-product-item").each(((e,o)=>{t(o).attr("data-product_variations")&&this.chooseVariation(t(o))})),o.find(".product-item__desc").each(((e,o)=>{t(o).get(0).scrollHeight>43&&(t(o).siblings(".wccon-product-title").append('<span class="desc-toggler"><svg><use xlink:href="#icon-ch-dw"></use></svg></span>'),t(o).addClass("desc-over"))}))}initPriceWidget(t){if(this.priceFilter=this.builderWrapper.find("#wccon-slider").get(0),this.priceWidget=this.builderWrapper.find(".wccon-slider-wrapper"),this.priceFilter){const e=parseFloat(this.priceFilter.dataset.minPrice),o=parseFloat(this.priceFilter.dataset.maxPrice),s=parseFloat(this.priceFilter.dataset.startPrice),i=parseFloat(this.priceFilter.dataset.endPrice);"init"===t&&(this.maxPrice=o,this.minPrice=e,this.manualChangedPrice=!1);const n=this.priceWidget.find(".inps");let c=o;if(c=this.manualChangedPrice?i>o?o:i:o>i?i:o,noUiSlider.create(this.priceFilter,{start:[s,c],connect:!0,step:1,format:{to:t=>parseFloat(t).toFixed(0),from:t=>parseFloat(t).toFixed(0)},range:{min:0,max:this.maxPrice},tooltips:!n.length}),n.length>0){const t=n.find(".inp-min"),e=n.find(".inp-max");this.priceWidget.find(".wccon-price-filter-button").on("click",(t=>{t.preventDefault(),this.manualChangedPrice=!0,this.buildQueryString(),this.sendRequest()})),t.on("change",(t=>{this.priceFilter.noUiSlider.set([parseInt(t.target.value,10),null])})),e.on("change",(t=>{this.priceFilter.noUiSlider.set([null,parseInt(t.target.value,10)])})),this.priceFilter.noUiSlider.on("update",((o,s)=>{const i=o[s];this.activeFilters.prices=o,s?e.val(i):t.val(i)}))}this.priceFilter.noUiSlider.on("end",(t=>{this.activeFilters.prices=t,this.manualChangedPrice=!0,this.buildQueryString(),this.sendRequest()}))}}initTooltips(){this.isDesktop&&this.toolTips.each(((e,o)=>{tippy(t(o).get(0),{content:t(o).data("tippy"),popperOptions:{modifiers:[{name:"eventListeners",enabled:!1}]}})}))}rebuildList(){if(this.isListExists())return console.log("rebuildList-1"),this.builderWrapperData;if(!this.savedList||this.savedList&&!this.saveToStorage)return console.log("rebuildList-2",this.saveToStorage),this.builderWrapperData;if(!WCCON_BUILDER_FRONT.nonce2)return this.builderWrapperData;JSON.parse(this.savedList);return console.log("rebuild not found"),this.builderWrapperData}loadListStart(e,o,s){this.loadListTimeOut=setTimeout((()=>{t(".wccon-component-wrapper",this.builderWrapper).addClass("wccon-loading")}),this.timeOutAnimationLoading),t.blockUI.defaults.overlayCSS.cursor="default",this.builderWrapper.block({message:null,overlayCSS:{background:"transparent"},blockMsgClass:"wccon-block-message"}),t(".blockUI.blockOverlay").addClass("wccon-block-overlay")}loadListEnd(e,o,s,i){this.builderWrapper.unblock(),clearTimeout(this.loadListTimeOut),this.loadListTimeOut=null,t(".wccon-component-wrapper",this.builderWrapper).removeClass("wccon-loading"),t(".blockUI.blockOverlay").removeClass("wccon-block-overlay")}maybeClearLists(){if(this.savedList&&this.saveToStorage&&WCCON_BUILDER_FRONT.nonce2){const t=JSON.parse(this.savedList);if(!Array.isArray(t))return console.log("removed wccon-list"),localStorage.removeItem("wccon-list"),void(this.savedList=null);let e=Array.isArray(WCCON_BUILDER_FRONT.saved_config_ids)?WCCON_BUILDER_FRONT.saved_config_ids:[];const o=t.filter((t=>-1!==e.indexOf(parseInt(t.id,10))));localStorage.setItem("wccon-list",JSON.stringify(o))}}maybeLoadList(){}search(t){16!==t.keyCode&&9!==t.keyCode&&(this.searchTimeOut&&clearTimeout(this.searchTimeOut),this.searchTimeOut=setTimeout((()=>{this.activeFilters.search=t.target.value,this.buildQueryString(),this.sendRequest(t)}),500))}handlePagination(t){t.preventDefault();let e=t.target.attributes["data-link"].nodeValue;this.activeFilters.pagination=e,this.buildQueryString(!0),this.sendRequest()}handleSelect(e){const o=t(e.currentTarget),s=o.find("ul"),i=o.find("svg");s.toggleClass("active"),i.toggleClass("active")}handleSorting(e){e.preventDefault();const o=t(e.currentTarget),s=o.closest(".wccon-dropdown-select").attr("data-type");this.activeFilters[s]=e.target.hash.slice(1),o.closest(".wccon-dropdown-select").find(".wccon-dropdown-inner span").text(o.text()),this.buildQueryString(),this.sendRequest()}handleVariationSelectOpen(e){const o=t(e.currentTarget),s=o.find("ul"),i=o.find("svg");s.toggleClass("active"),i.toggleClass("active")}handleVariationSelect(e){const o=t(e.currentTarget),s=o.closest("li").attr("data-value");if(o.closest("li").hasClass("disabled"))return;const i=o.closest(".product-attribute-group").find("select");i.length&&(o.closest(".product-attribute-group").find(".product-attribute-selected span").text(o.text()),o.closest(".product-attribute-group").find("li").attr("aria-selected","false"),o.closest("li").attr("aria-selected","true"),i.val(s),i.trigger("change"))}handleVariationColor(e){const o=t(e.currentTarget),s=o.closest("li").attr("data-value");if(o.closest("li").hasClass("disabled"))return;const i=o.closest(".product-attribute-group").find("select");i.length&&(o.closest(".product-attribute-group").find("li").attr("aria-checked","false"),o.closest("li").attr("aria-checked","true"),i.val(s),i.trigger("change"))}manageDropdown(e){e.preventDefault();let o=e.target.attributes["data-option"].nodeValue;t("option:selected",this.periodRange).removeAttr("selected"),this.periodRange.find("option").eq(o-1).attr("selected","selected"),t(".dropdown .dropdown-toggle").html(this.periodRange.find("option").eq(o-1).html()),this.periodRange.trigger("change")}handleForm(t){-1===["min_price","max_price"].indexOf(t.target.name)&&(this.buildQueryString(),this.sendRequest())}buildQueryString(t=!1,e={}){let o=this.form.serializeArray();console.log("Query string:",o);let s=[],i=[];o.forEach((t=>{if(/^wccon_tax_filter/.test(t.name)){let e=t.name.replace("wccon_tax_filter[","").slice(0,-1);console.log("tax_name",e);s.find((t=>t.tax_name===e))?s=s.map((o=>o.tax_name===e?{...o,tax_value:[...o.tax_value,t.value]}:o)):s.push({tax_name:e,tax_value:[t.value]})}if(/^wccon_meta_filter/.test(t.name)){let e=t.name.replace("wccon_meta_filter[","").slice(0,-1);console.log("meta_key",e);i.find((t=>t.meta_key===e))?i=i.map((o=>o.meta_key===e?{...o,meta_value:[...o.meta_value,t.value]}:o)):i.push({meta_key:e,meta_value:[t.value]})}})),this.activeFilters={tax_query:s,meta_query:i,prices:this.activeFilters.prices,pagination:t?this.activeFilters.pagination:1,orderby:this.activeFilters.orderby,stock:this.activeFilters.stock,search:this.searchField.val()},console.log(this.activeFilters);for(let t in this.activeFilters)this.query.delete(t),"tax_query"===t||"meta_query"===t?this.query.append(t,JSON.stringify(this.activeFilters[t])):"prices"===t?2===this.activeFilters.prices.length&&(this.minPrice===parseInt(this.activeFilters.prices[0],10)&&this.maxPrice===parseInt(this.activeFilters.prices[1],10)||!this.manualChangedPrice||this.query.append(t,this.activeFilters[t].join(","))):-1!==["pagination","orderby","stock","search"].indexOf(t)&&this.query.append(t,this.activeFilters[t]);console.log("Query string-2",this.query.toString())}sendRequest(){if(this.componentContainer=this.builderWrapper.find(`.wccon-component[data-component-slug=${this.componentSlug}]`),!this.componentContainer.length)return;const e=this.componentContainer.find(".wccon-products-body");!function(e,o){const s=[],i=t("<div />",{class:"wccon-skeleton-product-items"});for(let e=0;e<o;e++){const e=t("<div/>",{class:"wccon-skeleton-product-item"}),o=t("<div/>",{class:"wccon-skeleton-product-image"}),i=t("<div/>",{class:"wccon-skeleton-product-body"}),n=t("<div/>",{class:"wccon-skeleton-product-body__one"}),c=t("<div/>",{class:"wccon-skeleton-product-body__two"}),a=t("<div/>",{class:"wccon-skeleton-product-body__three"}),r=t("<div/>",{class:"wccon-skeleton-product-actions"});i.append(n),i.append(c),i.append(a),e.append(o),e.append(i),e.append(r),s.push(e)}i.append(s),e.find(".wccon-product-items").replaceWith(i)}(e,5);const o=h(this.componentSlug,this.productScheme.groups);this.query.append("selected_products",JSON.stringify(o)),t.ajax({url:this.ajaxUrl,type:"POST",data:`action=wccon_filter_builder&nonce=${this.nonce}&component_id=${this.componentId}&`+this.query.toString()}).then((o=>{t(e).find(".wccon-skeleton-product-items").remove(),console.log(o),o.success&&(this.componentContainer.find(".wccon-products-body").replaceWith(t(o.data.html).find(".wccon-products-body")),this.componentContainer.find("aside").replaceWith(t(o.data.html).find("aside")),this.form=t(document.body).find("#wccon-filter-form"),this.builderWrapper.trigger("wccon-filter-end",[this.componentSlug]))})).catch((t=>{console.log(t)}))}clearFilters(e){e.preventDefault(),this.activeFilters={tax_query:[],meta_query:[],search:"",prices:[],pagination:1,stock:"all",orderby:"menu_order"};for(const t in this.activeFilters)this.query.delete(t),"tax_query"===t||"meta_query"===t?this.query.append(t,JSON.stringify(this.activeFilters[t])):-1!==["pagination","orderby","stock","search"].indexOf(t)&&this.query.append(t,this.activeFilters[t]);const o=t(".wccon-dropdown-select[data-type=stock]"),s=t(".wccon-dropdown-select[data-type=orderby]");if(o.length){const e=o.find(".wccon-dropdown-inner span");o.find("li a").each(((o,s)=>{"#all"===t(s).attr("href")&&e.text(t(s).text())}))}if(s.length){const e=s.find(".wccon-dropdown-inner span");s.find("li a").each(((o,s)=>{"#menu_order"===t(s).attr("href")&&e.text(t(s).text())}))}this.searchField.val(""),this.sendRequest()}chooseProduct(e){e.preventDefault();const o=t(e.currentTarget),s=o.closest(".wccon-component"),i=s.hasClass("extra");s.addClass("selected"),i&&s.removeClass("exhide");const n=s.attr("data-component-slug"),c=s.attr("data-multiple"),r=s.find(".wccon-component-inner .wccon-component__body"),l=s.find(".wccon-component-inner .wccon-component__icon");s.find(".wccon-component__selected");l.hide();const p=o.closest(".wccon-product-item"),u=void 0!==p.attr("data-variation-id")&&this.maybeStringToNumber(p.attr("data-variation-id"),!1)>0?p.attr("data-variation-id"):p.attr("data-product-id"),m=p.attr("data-variation-id"),g=o.siblings(".product-item__price").find(".price").html(),f=p.find(".wccon-product-title").text(),w=o.closest(".wccon-product-item").find(".wccon-product-title").attr("href"),b=p.find(".wccon-product-sku span").text(),v=p.find(".product-item__image").html(),y=p.find(".stock"),C=p.attr("data-price"),k=p.data("product-info"),O=wp.template("wccon-filled-component"),x=[],S=p.find(".product-item__attributes");t(".product-attribute-group",S).each(((e,o)=>{let s=t(o).find("select").val(),i=t(o).find("select option:selected").text();const n=t(o).hasClass("product-attribute-group__color")?"color":"button";if("color"===n){s=t(o).find('li[aria-checked="true"]').find("div").css("background-color")}x.push({type:n,value:s,name:i})}));const R={title:f,href:w,image:v,sku:b===WCCON_BUILDER_FRONT.i18n_sku_na?"":b,stock_status:y.hasClass("outofstock")?"outofstock":"instock",price:g,quantity:1,product_id:u,multiple:c,variable:S.length,attributes:x};k&&this.soldIndividually&&(R.sold_individually=k.sold_individually??!1);const T=wp.hooks.applyFilters("wccon-choose-products-args",R,p,s);r.replaceWith(O(T));const W=o.closest(".wccon-component").attr("data-copy"),L={product_id:u,quantity:1,variation_id:m??"",variation:"",price:C,clone:W||0,component:n};console.log("VALUE",L,n,this.productScheme.groups);const N=d(n,this.productScheme.groups,L,"add");console.log("DATASTORE",N),this.productScheme={...this.productScheme,groups:N},this.dataStore=N,this.maybeSaveToStorage(),this.totalPrice=this.calculateTotals(),this.totalPriceField.html(a(this.totalPrice));const F=s.find(".wccon-component-inner");t(F).removeClass("opened"),t(s).removeClass("opened"),t(document.body).removeClass("wccon-component-opened"),t(F).siblings(".wccon-product-list").remove(),_(s,"off");const I=s.parent(".wccon-component");if(I.length){const e=I.attr("data-component-slug");I.addClass("selected");const o=h(e,this.productScheme.groups);console.log("SUB",o,e);const s=o.map((e=>{const o=t(`[data-component-slug=${e.component}]`),s=t(`.wccon-component-product[data-product-id=${e.product_id}]`);if(o.length&&s.length){const t=s.find(".wccon-component-product__title").text(),o=s.find(".wccon-component-product__image").html();return{...e,title:t,image:o}}return null})).filter((t=>null!==t)),i=wp.template("wccon-filled-subgroup"),n=I.find(".wccon-component-inner .wccon-component__body").first();n.siblings(".wccon-component__icon").hide(),n.replaceWith(i({products:s}))}this.totalsContainer.show(),this.builderWrapper.trigger("wccon-product-chosen",[n,u,this.dataStore,this.builderWrapper]),this.compatiblityEnabled&&WCCON_BUILDER_FRONT.nonce2?(null!==this.compatibilityRequest&&(this.compatibilityRequest.abort(),this.compatibilityRequest=null),this.compatibilityRequest=t.ajax({url:this.ajaxUrl,type:"POST",data:{action:"wccon_add_product",component_slug:n,data:JSON.stringify(this.dataStore),product:L,nonce:this.nonce}}),this.compatibilityRequest.then((t=>{console.log(t),this.runCompatibility(t.data.cd)})).catch((t=>{console.log(t)}))):this.runCompatibility({})}removeProduct(e){e.preventDefault();const o=t(e.currentTarget),s=o.closest(".wccon-component__body"),i=o.closest(".wccon-component"),n=i.hasClass("extra");i.removeClass("selected out-ofstock");o.closest(".wccon-component-inner").find(".wccon-component__icon").show();const c=o.closest(".wccon-component-product-item").find(".wccon-component-product").attr("data-product-id"),r=o.closest(".wccon-component").attr("data-copy"),l=o.closest(".wccon-component").attr("data-component-slug"),p=t(`[data-component-slug=${l}]`).length>1,u=i.parent(".wccon-component");if(r||!r&&p)i.remove();else{const t=wp.template("wccon-empty-component"),e={};o.closest(".wccon-component").find(".wccon-component__selected").find("svg").html('<use xlink:href="#icon-check"></use>'),s.replaceWith(t(e))}t(`[data-component-slug=${l}]`).each((function(e,o){t(this).attr("data-copy",(function(o,s){if(0!==e)return e;t(this).removeAttr("data-copy")}))})),console.log(this.productScheme.groups,r);const m=d(l,this.productScheme.groups,{product_id:c,clone:r||0},"remove");if(console.log("DATASTORE",m),this.productScheme={...this.productScheme,groups:m},this.dataStore=m,this.maybeSaveToStorage(),this.totalPrice=this.calculateTotals(),this.totalPriceField.html(a(this.totalPrice)),u.length){const e=u.attr("data-component-slug"),o=h(e,this.productScheme.groups);console.log("SUB",o,e);const s=o.map((e=>{const o=t(`[data-component-slug=${e.component}]`),s=t(`.wccon-component-product[data-product-id=${e.product_id}]`);if(o.length&&s.length){const t=s.find(".wccon-component-product__title").text(),o=s.find(".wccon-component-product__image").html();return{...e,title:t,image:o}}return null})).filter((t=>null!==t)),i=wp.template("wccon-filled-subgroup"),n=u.find(".wccon-component-inner .wccon-component__body").first();if(s.length)n.siblings(".wccon-component__icon").hide(),n.replaceWith(i({products:s}));else{u.removeClass("selected"),n.siblings(".wccon-component__icon").show();const t=wp.template("wccon-empty-subgroup");n.replaceWith(t({}))}}if(n){i.parents(".wccon-group").find(".wccon-component-extra").hasClass("opened")||i.addClass("exhide")}this.builderWrapper.trigger("wccon-product-removed",[l,c,this.dataStore,this.builderWrapper]),this.compatiblityEnabled&&WCCON_BUILDER_FRONT.nonce2?(null!==this.compatibilityRequest&&(this.compatibilityRequest.abort(),this.compatibilityRequest=null),this.compatibilityRequest=t.ajax({url:this.ajaxUrl,type:"POST",data:{action:"wccon_remove_product",component_slug:l,data:JSON.stringify(this.dataStore),nonce:this.nonce}}),this.compatibilityRequest.then((t=>{console.log(t),this.runCompatibility(t.data.cd)})).catch((t=>{console.log(t)}))):this.runCompatibility({})}runCompatibility(e){if(!this.compatiblityEnabled||!WCCON_BUILDER_FRONT.nonce2)return t(".wccon-component",this.builderWrapper).not(".wccon-component-has-children").each((function(){t(this).is(".selected")?t(this).find(".wccon-component__selected").addClass("compatible"):t(this).find(".wccon-component__selected").removeClass("compatible")})),void t(".wccon-component",this.builderWrapper).filter(".wccon-component-has-children").each((function(){t(this).find(".wccon-component.selected").length?t("> .wccon-component-inner",t(this)).find(".wccon-component__selected").addClass("compatible"):t("> .wccon-component-inner",t(this)).find(".wccon-component__selected").removeClass("compatible")}));t(".wccon-component__selected",this.builderWrapper).removeClass("incompatible compatible"),t(".product-top__required-item",this.builderWrapper).length&&t(".product-top__required-item",this.builderWrapper).removeClass("incompatible compatible"),t(".product-top__extra-item",this.builderWrapper).length&&t(".product-top__extra-item",this.builderWrapper).removeClass("incompatible compatible"),this.builderWrapper.trigger("wccon-run-compatibility",[this,e]),this.incompatibleData=[];const o=Object.values(e);console.log("Incompatibility products:",o);for(let e of o){let o;o=parseInt(e.clone,10)>0?t(`[data-component-slug=${e.slug}][data-copy=${parseInt(e.clone,10)}]`,this.builderWrapper).first():t(`[data-component-slug=${e.slug}]`,this.builderWrapper).not("[data-copy]").first();const s=o.find(".wccon-component__selected");if(e.compatible)s.addClass("compatible"),s.find("svg").html('<use xlink:href="#icon-check"></use>'),t(`.product-top__required-item[data-image-slug="${e.slug}"]`).addClass("compatible"),t(`.product-top__extra-item[data-image-slug="${e.slug}"]`).addClass("compatible");else{this.incompatibleData=[...this.incompatibleData,{slug:e.slug,clone:e.clone,text:e.tippyText}],s.addClass("incompatible"),s.find("svg").html('<use xlink:href="#icon-uncheck"></use>'),t(`.product-top__required-item[data-image-slug="${e.slug}"]`).addClass("incompatible"),t(`.product-top__extra-item[data-image-slug="${e.slug}"]`).addClass("incompatible");let o=!0;this.isMobile&&(o=!1);wp.hooks.applyFilters("wccon-display-compatibility-alerts",o)&&toastr.error(e.text)}}t(".wccon-component-has-children",this.builderWrapper).each(((e,o)=>{let s=!0,i=!1;const n=[];t(".wccon-component",t(o)).each((function(){t(this).find(".wccon-component__selected.compatible").length&&(i=!0,n.push(!0)),t(this).find(".wccon-component__selected.incompatible").length&&(i=!0,s=!1,n.push(!1))}));const c=t(o).attr("data-component-slug"),a=t(".wccon-component-inner",t(o)).first().find(".wccon-component__selected");i&&s?(a.addClass("compatible"),a.find("svg").html('<use xlink:href="#icon-check"></use>')):i&&!s&&(a.addClass("incompatible"),a.find("svg").html('<use xlink:href="#icon-uncheck"></use>')),n.length&&-1!==n.indexOf(!0)?t(`.product-top__required-item[data-image-slug="${c}"]`).addClass("compatible"):n.length&&-1===n.indexOf(!0)&&t(`.product-top__required-item[data-image-slug="${c}"]`).addClass("incompatible")})),this.showTippy()}runCompatibilitySaved(){this.compatiblityEnabled&&t(".wccon-component",this.builderWrapper).each((function(e,o){const s=t(o).attr("data-tippy");if(s&&""!==s){const e=t(o).find(".wccon-component__selected");e.length&&tippy(e.get(0),{content:s,popperOptions:{modifiers:[{name:"eventListeners",enabled:!1}]}})}}))}quantityButtonsHandler(t){}editProduct(e){const o=e.currentTarget,s=t(o).closest(".wccon-component-inner");this.handleGetProducts(s)}collapseProducts(e){e.preventDefault(),e.stopPropagation();const o=e.currentTarget,s=t(o).closest(".wccon-component-inner"),i=t(o).closest(".wccon-component");t(s).removeClass("opened"),i.removeClass("opened"),t(document.body).removeClass("wccon-component-opened"),t(s).siblings(".wccon-product-list").remove(),_(i,"off"),!i.hasClass("selected")&&i.attr("data-copy")&&i.remove(),null!==this.productRequest&&(this.productRequest.abort(),this.productRequest=null),this.totalsContainer.show()}buyProduct(e){e.preventDefault();const o=e.currentTarget;this.builderWrapper.trigger("wccon-before-adding-to-cart",[this]),t(o).attr("disabled",!0),t(o).addClass("loading"),t.ajax({url:this.ajaxUrl,type:"POST",data:{action:"wccon_buy_product",data:JSON.stringify(this.dataStore),nonce:this.nonce},beforeSend:()=>{t(document.body).trigger("adding_to_cart")}}).then((e=>{if(console.log(e),e.success&&e.data.fragments){const s="sessionStorage"in window&&null!==window.sessionStorage;if(void 0!==window.wc_cart_fragments_params){const o=wc_cart_fragments_params.cart_hash_key;t.each(e.data.fragments,(function(e,o){t(e).replaceWith(o)})),s&&(sessionStorage.setItem(wc_cart_fragments_params.fragment_name,JSON.stringify(e.data.fragments)),localStorage.setItem(o,e.data.cart_hash),sessionStorage.setItem(o,e.data.cart_hash),e.data.cart_hash&&sessionStorage.setItem("wc_cart_created",(new Date).getTime()))}t(document.body).trigger("wc_fragments_refreshed"),t(document.body).trigger("wccon_buy_list_success",[e.data]),t(o).attr("disabled",!1),t(o).removeClass("loading")}})).catch((e=>{console.log(e),t(document.body).trigger("wccon_buy_list_error"),t(document.body).trigger("wc_fragments_ajax_error")}))}calculateTotals(t=this.dataStore){let e=0;const o=this;for(const s of t)s.hasOwnProperty("products")&&(e=s.products.reduce((function(t,e){let s=0,i=1;return e.hasOwnProperty("price")&&""!==e.price&&(s=o.maybeStringToNumber(e.price),i=o.maybeStringToNumber(e.quantity,!1)),t+s*i}),e)),s.hasOwnProperty("components")&&(e+=this.calculateTotals(s.components));return e}chooseVariation(t){const e=t.data("product_variations"),o=t.find(".stock"),s=this.getChosenAttributes(t),i=s.data,n=this.findMatchingVariations(e,i).shift(),c=t.find(".price"),a=t.find(".wccon-product-sku span"),r=t.find(".stock"),l=t.find(".product-item__image img"),d=wp.hooks.applyFilters("wccon-variation-first-match",!1);if(s.count&&d&&this.updateVariations("firstmatch"),s.count&&s.count===s.chosenCount)if(n)if(s.chosenCount){this.wccon_set_content(c,n.price_html?n.price_html:n.range_html),this.wccon_set_content(a,n.sku?n.sku:WCCON_BUILDER_FRONT.i18n_sku_na),this.wccon_set_content(r,n.stock_html),n.image&&n.image.url&&n.image.url.length>0&&this.wccon_set_variation_attr(l,"src",n.image.url),t.attr("data-variation-id",n.variation_id),t.attr("data-price",n.display_price),n.is_in_stock?(t.find(".product-item__add").attr("disabled",!1),o.removeClass("outofstock").addClass("instock"),o.html(n.stock_html)):(t.find(".product-item__add").attr("disabled",!0),o.removeClass("instock").addClass("outofstock"),o.html(n.nostock_html));t.closest(".wccon-builder-wrapper").find(`.wccon-component-product[data-product-id="${n.variation_id}"]`).length&&t.find(".product-item__add").attr("disabled",!0)}else this.wccon_set_content(c,n.range_price),this.wccon_set_content(a,n.sku?n.sku:WCCON_BUILDER_FRONT.i18n_sku_na),this.wccon_set_content(r,n.stock_html),n.image&&n.image.url&&n.image.url.length>0&&this.wccon_set_variation_attr(l,"src",n.image.url),t.attr("data-variation-id",""),t.attr("data-price",""),t.find(".product-item__add").attr("disabled",!0);else s.chosenCount=0,t.find(".product-item__add").attr("disabled",!0);else s.chosenCount=0,t.find(".product-item__add").attr("disabled",!0);this.updateVariations()}updateVariations(){t(".wccon-product-item",this.builderWrapper).filter(((e,o)=>t(o).attr("data-product_variations"))).each(((e,o)=>{const s=t(o).data("product_variations"),i=this.getChosenAttributes(t(o)).data;t(o).find("select[name^=attribute_]").each(((e,o)=>{const n=t(o).closest(".product-attribute-group__st-select"),c=t(o).data("attribute_name"),a=t.extend(!0,{},i);a[c]="";const r=this.findMatchingVariations(s,a);if(console.log("VARIATIONS",r),n.length){let e=t(o),s=t(o).data("show_option_none"),i=":gt(0)",n=0,a=t("<select/>"),b=e.val()||"",v=!0;if(!e.data("attribute_html")){var l=e.clone();l.find("option").removeAttr("attached").prop("disabled",!1).prop("selected",!1),e.data("attribute_options",l.find("option"+i).get()),e.data("attribute_html",l.html())}for(var d in a.html(e.data("attribute_html")),r)if(void 0!==r[d]){var p=r[d].attributes;for(var u in p)if(p.hasOwnProperty(u)){var h=p[u],m="";if(u===c)if(r[d].variation_is_active&&(m="enabled"),h){h=t("<div/>").html(h).text();var g=a.find("option");if(g.length)for(var _=0,f=g.length;_<f;_++){var w=t(g[_]);if(h===w.val()){w.addClass("attached "+m);break}}}else a.find("option:gt(0)").addClass("attached "+m)}}n=a.find("option.attached").length,b&&(v=!1,0!==n&&a.find("option.attached.enabled").each((function(){var e=t(this).val();if(b===e)return v=!0,!1}))),n>0&&b&&v&&"no"===s&&(a.find("option:first").remove(),i=""),a.find("option"+i+":not(.attached)").remove(),e.html(a.html()),e.find("option"+i+":not(.enabled)").prop("disabled",!0),b?v?e.val(b):e.val("").trigger("change"):e.val("")}const b=this.findVariationValue(r,c),v=t(o).closest(".product-attribute-group__nice-select"),y=t(o).closest(".product-attribute-group__color"),C=t(o).closest(".product-attribute-group__button");if(v.length){v.find("select option");const e=v.find("select").val(),o=v.find("ul").find("li"),s=v.find(".product-attribute-selected span");o.removeClass("disabled"),o.each(((o,i)=>{const n=t(i).attr("data-value"),c=e===n?"true":"false";t(i).removeClass("disabled"),""!==n&&-1===b.indexOf(n)&&t(i).addClass("disabled"),"true"===c&&s.text(t(i).text())}))}if(y.length){y.find("select option");const e=y.find("select").val(),o=y.find("ul").find("li");o.removeClass("disabled"),o.each(((o,s)=>{const i=t(s).attr("data-value"),n=e===i?"true":"false";t(s).removeClass("disabled"),""!==i&&-1===b.indexOf(i)&&t(s).addClass("disabled"),t(s).attr("aria-checked",n)}))}if(C.length){C.find("select option");const e=C.find("select").val(),o=C.find("ul").find("li");o.removeClass("disabled"),o.each(((o,s)=>{const i=t(s).attr("data-value"),n=e===i?"true":"false";t(s).removeClass("disabled"),""!==i&&-1===b.indexOf(i)&&t(s).addClass("disabled"),t(s).attr("aria-checked",n)}))}}))}))}findVariationValue(t,e,o){const s=[];for(const o in t)if(void 0!==t[o]){const i=t[o].attributes;for(const t in i)if(i.hasOwnProperty(t)){const o=i[t];t===e&&s.push(o)}}return s}resetVariations(e){e.preventDefault();const o=t(e.currentTarget).closest(".wccon-product-item"),s=o.find(".wccon-product-sku span"),i=o.find(".price"),n=o.find(".stock"),c=o.find(".product-item__image img");o.find("select[name^=attribute_]").val("").trigger("change");const a=o.find(".product-attribute-group__nice-select");a.length&&a.each((function(e,o){const s=t(o).find("select[name^=attribute_] option:eq(0)");t(o).find(".product-attribute-selected span").text(s.text())})),this.wccon_reset_content(s),this.wccon_reset_content(i),this.wccon_reset_content(n),this.wccon_reset_variation_attr(c,"src"),n.html().includes("#icon-chk-small")?n.removeClass("outofstock").addClass("instock"):n.removeClass("instock").addClass("outofstock"),o.trigger("reset_data")}findMatchingVariations(t,e){const o=[];for(let s=0;s<t.length;s++){const i=t[s];this.isMatch(i.attributes,e)&&o.push(i)}return o}isMatch(t,e){let o=!0;for(const s in t)if(t.hasOwnProperty(s)){const i=t[s],n=e[s];void 0!==i&&void 0!==n&&0!==i.length&&0!==n.length&&i!==n&&(o=!1)}return o}getChosenAttributes(e){const o={};let s=0,i=0;return e.find("select[name^=attribute_]").each((function(){const e=t(this).data("attribute_name")||t(this).attr("name"),n=t(this).val()||"";n.length>0&&i++,s++,o[e]=n})),{count:s,chosenCount:i,data:o}}addMultiple(t){}handleExpandDescription(e){e.preventDefault(),e.stopPropagation();const o=e.currentTarget;t(o).closest(".wccon-product-title").siblings(".product-item__desc").toggleClass("active"),t(o).toggleClass("active")}maybeGetProducts(e){const o=e.currentTarget,s=t(o).closest(".wccon-component");if(console.log("ATTEMP get products"),s.hasClass("wccon-component-has-children"))s.toggleClass("subgroup-opened");else if(!s.hasClass("selected")&&(t(o).hasClass("opened")||(this.builderWrapper.find(".wccon-component").not(s).each(((e,o)=>{t(o).removeClass("opened"),t(o).find(".wccon-component-inner").removeClass("opened"),t(o).find(".wccon-product-list").remove()})),null!==this.productRequest&&(this.productRequest.abort(),this.productRequest=null),this.totalsContainer.show()),!t(e.target).closest(".wccon-component-product-item").length))return t(o).hasClass("opened")?(t(o).removeClass("opened"),s.removeClass("opened"),t(o).siblings(".wccon-product-list").remove(),t(document.body).removeClass("wccon-component-opened"),_(s,"off"),!s.hasClass("selected")&&s.attr("data-copy")&&s.remove(),null!==this.productRequest&&(this.productRequest.abort(),this.productRequest=null),void this.totalsContainer.show()):void(s.hasClass("selected")||this.handleGetProducts(o))}handleGetProducts(e){const o=t(e).closest(".wccon-component"),s=o.hasClass("extra");let i="component_id";t(e).siblings(".wccon-component").length&&(i="subgroup_id");const n=o.data("component-id"),c=o.data("component-slug");this.componentId=n,this.componentSlug=c,function(e,o,s=!1){const i=[],n=t(e);if(!n.length)return;const c=t("<div />",{class:"wccon-product-list"}),a=t("<div />",{class:"wccon-skeleton-aside"}),r=[];for(let e=0;e<3;e++){const e=t("<div />",{class:"wccon-skeleton-filter-item"}),o=t("<div/>",{class:"wccon-skeleton-filter-head"}),s=t("<div/>",{class:"wccon-skeleton-filter-list"}),i=[];for(let e=0;e<5;e++){const e=t("<div/>",{class:"wccon-skeleton-filter-list__item"}),o=t("<div/>",{class:"wccon-skeleton-filter-list__check"}),s=t("<div/>",{class:"wccon-skeleton-filter-list__label"});e.append(o),e.append(s),i.push(e)}s.append(i),e.append(o),e.append(s),r.push(e)}a.append(r);const l=t("<div />",{class:"wccon-skeleton-content"}),d=t("<div />",{class:"wccon-skeleton-content-top"}),p=t("<div />",{class:"wccon-skeleton-content-top__one"}),u=t("<div />",{class:"wccon-skeleton-content-top__two"}),h=t("<div />",{class:"wccon-skeleton-content-top__three"});d.append(p),d.append(u),d.append(h);const m=t("<div />",{class:"wccon-skeleton-product-items wccon-scrl-container"});for(let e=0;e<o;e++){const e=t("<div/>",{class:"wccon-skeleton-product-item"}),o=t("<div/>",{class:"wccon-skeleton-product-image"}),s=t("<div/>",{class:"wccon-skeleton-product-body"}),n=t("<div/>",{class:"wccon-skeleton-product-body__one"}),c=t("<div/>",{class:"wccon-skeleton-product-body__two"}),a=t("<div/>",{class:"wccon-skeleton-product-body__three"}),r=t("<div/>",{class:"wccon-skeleton-product-actions"});s.append(n),s.append(c),s.append(a),e.append(o),e.append(s),e.append(r),i.push(e)}m.append(i),l.append(d),l.append(m),c.append(a),c.append(l),s?n.html(c):c.insertAfter(n)}(e,5),t(e).addClass("opened"),o.addClass("opened"),t("html, body").animate({scrollTop:t(e).offset().top},200),t(document.body).addClass("wccon-component-opened"),_(o,"on"),this.builderWrapper.trigger("wccon-component-opened",[c]);const a=h(c,this.productScheme.groups);console.log("component products:",a),this.totalsContainer.hide(),null!==this.productRequest&&(this.productRequest.abort(),this.productRequest=null),this.productRequest=t.ajax({url:this.ajaxUrl,type:"POST",data:{action:"wccon_component_products",[i]:n,extra:s,products:a,nonce:this.nonce}}),this.productRequest.then((s=>{if(console.log(s),s.success){t(e).siblings(".wccon-product-list").remove(),t(s.data.html).insertAfter(t(e)),this.builderWrapper.trigger("wccon-products-loaded",[c]),_(o,"off");_(t(e).closest(".wccon-component"),"on")}})).catch((t=>console.log(t)))}saveList(e){e.preventDefault();let o=0;this.isListExists()&&(o=this.getListId());const s=t(e.currentTarget).closest("button");s.attr("disabled",!0),s.addClass("loading"),console.log("Product scheme:",this.productScheme),t.ajax({url:this.ajaxUrl,type:"POST",data:{action:"wccon_save_list",data:JSON.stringify(this.productScheme),id:this.builderId,saved_list_id:o,nonce:this.nonce}}).then((t=>{if(console.log(t),t.success)toastr.success(this.successMessage);else{const e=t.data.message?t.data.message:this.errorMessage;toastr.error(e)}s.attr("disabled",!1),s.removeClass("loading")})).catch((t=>{console.log(t),toastr.error(this.errorMessage)}))}clearList(e){e.preventDefault(),this.productScheme={...this.productScheme,groups:l(this.builderWrapperData.groups)},this.dataStore=this.productScheme.groups,this.maybeSaveToStorage(),this.totalPrice=this.calculateTotals(),this.totalPriceField.html(a(this.totalPrice));const o=t(".wccon-component[data-component-slug]",this.builderWrapper),s=wp.template("wccon-empty-component"),i=wp.template("wccon-empty-subgroup");o.each(((e,o)=>{t(o).attr("data-copy")&&t(o).remove();const n=t(o).find(".wccon-component__body"),c=t(o).hasClass("wccon-component-has-children");t(o).removeClass("selected");const a=t(o).find(".wccon-component__selected");if(a.find("svg").html('<use xlink:href="#icon-check"></use>'),a.removeClass("compatible incompatible"),c){const e=t(o).find(".wccon-component-inner .wccon-component__body").first();e.siblings(".wccon-component__icon").show(),e.replaceWith(i({}))}else{const t={};n.siblings(".wccon-component__icon").show(),n.replaceWith(s(t))}})),this.builderWrapper.trigger("wccon-builder-cleared",[this])}shareList(e){e.preventDefault();const o=t(this).parents(".wccon-product-top__right").find(".wccon-share-box");if(o.toggleClass("active"),window.matchMedia("(max-width: 768px)").matches)t(this).is(".wccon-share-list-button")?t("#wccon-share-modal").fadeIn(400,(function(e){t(this).css("display","flex")})):t("#wccon-share-modal").fadeOut(400,(function(e){t(this).css("display","none")}));else if(t(this).is(".wccon-share-list-button")){const t=o.get(0).scrollHeight;o.hasClass("jcstart")||o.addClass("jcstart"),o.outerHeight(t+10)}else t(this).is(".wccon-share-close")&&o.hasClass("jcstart")&&o.outerHeight(0)}async copyLink(e){e.preventDefault();const o=t(e.currentTarget).attr("href");if(navigator.clipboard)try{await navigator.clipboard.writeText(o),toastr.success(this.copiedMessage)}catch(t){console.error("Failed to copy: ",t)}else{const e=t("<input />",{type:"text"});e.val(o),e.css("position","absolute"),e.css("left","-9999px"),t(document.body).append(e),e.focus(),e.select(),document.execCommand("copy"),e.remove(),toastr.success(this.copiedMessage)}}toggleWidget(){const e=t(this).siblings(".wccon-widget-body");if(t(this).toggleClass("active"),e.toggleClass("active"),e.hasClass("active")){const t=wp.hooks.applyFilters("wccon-widget-body-height","220px");e.css("max-height",t),e.parent().addClass("opened")}else e.css("max-height","0px"),e.parent().removeClass("opened")}openMyListsHandler(e){e.preventDefault(),t("html").css("overflow","hidden");const o=this;t("#wccon-user-list").fadeIn(400,(function(e){t(this).css("display","flex"),t(".wccon-saved-lists",t("#wccon-user-list")).length?u("#wccon-user-list"):(g("#wccon-user-list .wccon-modal__body",6),u("#wccon-user-list"),t.ajax({url:WCCON_BUILDER_FRONT.ajax_url,type:"POST",data:{action:"wccon_user_list",nonce:WCCON_BUILDER_FRONT.nonce,shortcode_id:t(o).closest(".wccon-builder-wrapper").data("wccon-builder")}}).then((e=>{console.log(e),t("#wccon-user-list").find(".wccon-skeleton-item").remove(),t(".wccon-modal__body",t("#wccon-user-list")).html(e.data.html),u("#wccon-user-list")})))}))}openUsersListsHandler(e){e.preventDefault(),t("html").css("overflow","hidden");const o=this;t("#wccon-users-list").fadeIn(400,(function(e){t(this).css("display","flex"),t(".wccon-saved-lists",t("#wccon-users-list")).length?u("#wccon-users-list"):(g("#wccon-users-list .wccon-modal__body",6),u("#wccon-users-list"),t.ajax({url:WCCON_BUILDER_FRONT.ajax_url,type:"POST",data:{action:"wccon_users_list",nonce:WCCON_BUILDER_FRONT.nonce,shortcode_id:t(o).closest(".wccon-builder-wrapper").data("wccon-builder")}}).then((e=>{console.log(e),t("#wccon-users-list").find(".wccon-skeleton-item").remove(),t(".wccon-modal__body",t("#wccon-users-list")).html(e.data.html),u("#wccon-users-list")})))}))}closeModal(e){e.preventDefault(),t("html").css("overflow","initial"),t(this).closest(".wccon-modal").fadeOut(400,(function(e){t(this).css("display","none")}))}openFilters(e){e.preventDefault(),t(".wccon-product-list aside").addClass("opened")}closeFilters(e){e.preventDefault(),t(".wccon-product-list aside").removeClass("opened")}toggleExtraHandler(e){const o=t(e.currentTarget).closest(".wccon-component-extra"),s=t(o).parents(".wccon-group");o.toggleClass("opened"),t(".wccon-component.extra",s).not(".selected").toggleClass("exhide")}expandWidget(){const e=t(this).closest(".wccon-widget-body");e.find(".h-widget").removeClass("h-widget");e.find(".wccon-widget-items").addClass("active"),t(this).hide(),t(this).closest(".widget-expander").addClass("opened"),t(this).siblings(".widget-expander-hide").show()}collapseWidget(){const e=t(this).closest(".wccon-widget-body");e.find("li").each(((e,o)=>{void 0!==t(o).attr("data-hide-widget")&&t(o).addClass("h-widget")}));e.find(".wccon-widget-items").removeClass("active"),t(this).hide(),t(this).closest(".widget-expander").removeClass("opened"),t(this).siblings(".widget-expander-show").show()}showTippy(){for(const t of this.tippyInstances)t[0].destroy();if(!t.isEmptyObject(this.incompatibleData))for(const e of this.incompatibleData){if(parseInt(e.clone,10)>0){t(`[data-component-slug=${e.slug}][data-copy="${e.clone}"]`).attr("data-tippy",e.text);const o=tippy(`[data-component-slug="${e.slug}"][data-copy="${e.clone}"] .wccon-component__selected`,{content:e.text,popperOptions:{modifiers:[{name:"eventListeners",enabled:!1}]}});this.tippyInstances.push(o)}else{t(`[data-component-slug=${e.slug}]`).not("[data-copy]").attr("data-tippy",e.text);const o=tippy(`[data-component-slug="${e.slug}"]:not([data-copy]) .wccon-component__selected`,{content:e.text,popperOptions:{modifiers:[{name:"eventListeners",enabled:!1}]}});this.tippyInstances.push(o)}}}hideTippy(e){for(const t of this.tippyInstances)t[0].destroy();for(const e of this.incompatibleData){if(parseInt(e.clone,10)>0){if(void 0!==t(`[data-component-slug=${e.slug}][data-copy="${e.clone}"]`).attr("data-tippy")){tippy(`[data-component-slug="${e.slug}"][data-copy="${e.clone}"] .wccon-component__selected`)}}else if(void 0!==t(`[data-component-slug=${e.slug}]`).not("[data-copy]").attr("data-tippy")){tippy(`[data-component-slug="${e.slug}"]:not([data-copy]) .wccon-component__selected`)}}}maybeStringToNumber(t,e=!0){let o=0;return o=e?parseFloat(t):parseInt(t,10),o=isNaN(o)||!isFinite(o)?0:o,o}maybeSaveToStorage(){if(!this.saveToStorage)return;if(this.isListExists())return;const t=localStorage.getItem("wccon-list"),e=t?JSON.parse(t):[];if(e.find((t=>parseInt(t.id,10)===parseInt(this.builderId,10)))){const t=e.map((t=>{if(parseInt(t.id,10)===parseInt(this.builderId,10)){const e={...t,groups:this.productScheme.groups};return this.currentLang&&(e.lang=this.currentLang),e}return t}));return localStorage.setItem("wccon-list",JSON.stringify(t)),void console.log("maybeSaveToStorage1",t,localStorage.getItem("wccon-list"))}const o={groups:this.productScheme.groups,id:this.builderId};this.currentLang&&(o.lang=this.currentLang),e.push(o),console.log("maybeSaveToStorage2",e,localStorage.getItem("wccon-list")),localStorage.setItem("wccon-list",JSON.stringify(e))}isListExists(){const t=window.location.href;return!!new RegExp(WCCON_BUILDER_FRONT.endpoint_slug+"\\/\\edit\\/\\d+").test(t)||!(!this.savedListQuery||!r(this.savedListQuery))}getListId(){const t=window.location.href,e=new RegExp(WCCON_BUILDER_FRONT.endpoint_slug+"\\/\\edit\\/(\\d+)"),o=t.match(e);return o?parseInt(o[1],10):this.savedListQuery&&r(this.savedListQuery)?r(this.savedListQuery):0}isAccountPage(){const t=window.location.href;return!!new RegExp(WCCON_BUILDER_FRONT.endpoint_slug+"\\/\\edit\\/\\d+").test(t)}wccon_set_content(t,e){void 0===t.attr("data-o_content")&&t.attr("data-o_content",t.html()),t.html(e)}wccon_reset_content(t){void 0!==t.attr("data-o_content")&&t.html(t.attr("data-o_content"))}wccon_set_variation_attr(t,e,o){void 0===t.attr("data-o_"+e)&&t.attr("data-o_"+e,t.attr(e)?t.attr(e):""),!1===o?t.removeAttr(e):t.attr(e,o)}wccon_reset_variation_attr(t,e){void 0!==t.attr("data-o_"+e)&&t.attr(e,t.attr("data-o_"+e))}}t(document).ready((function(){const e=t(".wccon-builder-wrapper").first();e.length&&(new f(e),t(document.body).addClass("wccon-page-builder"))}));new class{constructor(){this.successMessage=WCCON_BUILDER_FRONT.i18n_success_message,this.copiedMessage=WCCON_BUILDER_FRONT.i18n_copied_message,this.successMessageRemove=WCCON_BUILDER_FRONT.i18n_success_message_remove,this.errorMessage=WCCON_BUILDER_FRONT.i18n_error_message,this.addedToCartMessage=WCCON_BUILDER_FRONT.i18n_added_to_cart,this.removeListMessage=WCCON_BUILDER_FRONT.i18n_remove_list,this.endpoint=WCCON_BUILDER_FRONT.endpoint,this.nonce=WCCON_BUILDER_FRONT.nonce,this.removeListButton=t(".wccon-remove-list"),t(document.body).on("click",".wccon-list-button-buy",this.buyProduct).on("click",".wccon-list-button-share",this.toggleShare).on("click",".wccon-close-share",this.toggleShare).on("click",".wccon-saved-list .share-link",this.copyLink.bind(this)).on("wccon_buy_list_success",this.buySuccess.bind(this)).on("wccon_buy_list_error",this.buySuccess.bind(this)).on("click",".wccon-load-more",this.loadMore),this.removeListButton.on("click",this.removeList.bind(this)),window.location.href===this.endpoint&&t(document.body).addClass("wccon-page-builder")}buyProduct(e){e.preventDefault();const o=t(this).data("id");o&&(t(document.body).trigger("wccon-before-adding-to-cart",[o]),t(this).attr("disabled",!0),t(this).addClass("loading"),t.ajax({url:WCCON_BUILDER_FRONT.ajax_url,type:"POST",data:{action:"wccon_buy_list",list_id:o,nonce:WCCON_BUILDER_FRONT.nonce}}).then((e=>{if(console.log(e),e.success&&e.data.fragments){const o="sessionStorage"in window&&null!==window.sessionStorage;if(void 0!==window.wc_cart_fragments_params){const s=wc_cart_fragments_params.cart_hash_key;t.each(e.data.fragments,(function(e,o){t(e).replaceWith(o)})),o&&(sessionStorage.setItem(wc_cart_fragments_params.fragment_name,JSON.stringify(e.data.fragments)),localStorage.setItem(s,e.data.cart_hash),sessionStorage.setItem(s,e.data.cart_hash),e.data.cart_hash&&sessionStorage.setItem("wc_cart_created",(new Date).getTime()))}t(document.body).trigger("wc_fragments_refreshed"),t(document.body).trigger("wccon_buy_list_success",[e.data]),t(this).attr("disabled",!1),t(this).removeClass("loading")}})).catch((e=>{console.log(e),t(document.body).trigger("wccon_buy_list_error"),t(document.body).trigger("wc_fragments_ajax_error")})))}buySuccess(e,o){toastr.success(this.addedToCartMessage),setTimeout((()=>{t("html").css("overflow","initial"),t(".wccon-modal").fadeOut()}),800)}buyError(t,e){toastr.error(this.errorMessage)}toggleShare(){t(this).closest(".wccon-saved-list").find(".saved-lists__share-box").toggleClass("active")}async copyLink(e){e.preventDefault();const o=t(e.currentTarget).attr("href");if(navigator.clipboard)try{await navigator.clipboard.writeText(o),toastr.success(this.copiedMessage)}catch(t){console.error("Failed to copy: ",t)}else{const e=t("<input />",{type:"text"});e.val(o),e.css("position","absolute"),e.css("left","-9999px"),t(document.body).append(e),e.focus(),e.select(),document.execCommand("copy"),e.remove(),toastr.success(this.copiedMessage)}}loadMore(e){e.preventDefault();const o=t(this).attr("data-current"),s=t(this).attr("data-total"),i=t(".wccon-builder-wrapper").first().data("wccon-builder");if(r(s)<=r(o))return;const n=t(this).closest(".wccon-modal"),c=t(this).data("type");t(this).addClass("loading"),t(this).attr("disabled",!0),"user"===c?(g("#wccon-user-list .wccon-saved-lists",6,!0,!0),u(n)):(g("#wccon-users-list .wccon-saved-lists",6,!0,!0),u(n)),t.ajax({url:WCCON_BUILDER_FRONT.ajax_url,type:"POST",data:{action:"wccon_load_more",nonce:WCCON_BUILDER_FRONT.nonce,listType:c,currentPage:o,shortcode_id:i}}).then((e=>{if(console.log(e),e.success){n.find(".wccon-skeleton-item").remove();const i=t.parseHTML(e.data.html);let c=!0;t(i[0]).find(".wccon-saved-list").each((function(e,o){c=!1,t(".wccon-saved-lists",n).append(t(o))})),u(n),t(this).removeClass("loading"),t(this).attr("disabled",!1),t(this).attr("data-current",r(o)+1),r(s)<=r(o)+1&&t(this).hide()}})).catch((t=>{console.log(t)}))}removeList(e){e.preventDefault();const o=t(e.currentTarget).closest("button").data("id");wp.hooks.applyFilters("wccon-remove-list",(()=>{window.confirm(this.removeListMessage)&&t.ajax({url:WCCON_BUILDER_FRONT.ajax_url,type:"POST",data:{action:"wccon_remove_list",listId:o,nonce:WCCON_BUILDER_FRONT.nonce}}).then((e=>{console.log(e),e.success&&e.data.deleted?(toastr.success(this.successMessageRemove),t(`.wccon-saved-list[data-id="${e.data.list_id}"]`).remove()):toastr.error(this.errorMessage)})).catch((t=>{console.log(t)}))}),o,this)()}},t(window).resize((function(){!function(){const o=window.innerHeight;t(".wccon-product-list .aside").css({height:o-70+"px","max-height":"none"});const s=t(".wccon-modal");s.length&&(o<660||window.innerWidth,s.each(((s,i)=>{const n=t(i).find(".wccon-saved-lists"),c=t(i).find(".wccon-modal-inner"),a=t(i).find(".wccon-modal__header"),r=t(i).find(".wccon-button-container"),l=(c.outerHeight(),a.outerHeight());let d=r.outerHeight();d||(d=50);let p=150;e&&(p=50);const u=o-l-d-p;n.height(u)})))}()}))}(jQuery);